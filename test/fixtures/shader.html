<!doctype html>
<div id="container"></div>
<script type="x-shader/x-fragment" id="fragmentShader">
    #version 300 es
    precision mediump float;
    in vec2 vUv;
    out vec4 fragColor;

    void main() {
        // Normalized pixel coordinates (from 0 to 1)
        vec2 st = vUv;

        // redish in x, greenish in y
        // Try to modify the following line to have a blue gradient
        // from left to right.
        fragColor = vec4(st.x, st.y, 0.0, 1.0); // RGBA
    }
</script>
<script type="module">
    const canvas = document.createElement("canvas");
    canvas.width = 800;
    canvas.height = 600;
    document.getElementById("container").appendChild(canvas);

    const gl = canvas.getContext("webgl2");
    if (!gl) throw new Error("WebGL2 not supported");

    const vs = `#version 300 es
in vec2 a_position;
out vec2 vUv;
void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    vUv = (a_position + 1.0) * 0.5;
}`;

    const fs = document.getElementById("fragmentShader").textContent.trim();

    function compileShader(type, source) {
        const shader = gl.createShader(type);
        gl.shaderSource(shader, source);
        gl.compileShader(shader);
        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
            throw new Error(gl.getShaderInfoLog(shader));
        }
        return shader;
    }

    const program = gl.createProgram();
    gl.attachShader(program, compileShader(gl.VERTEX_SHADER, vs));
    gl.attachShader(program, compileShader(gl.FRAGMENT_SHADER, fs));
    gl.linkProgram(program);
    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
        throw new Error(gl.getProgramInfoLog(program));
    }

    const buffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
    gl.bufferData(
        gl.ARRAY_BUFFER,
        new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]),
        gl.STATIC_DRAW,
    );

    const pos = gl.getAttribLocation(program, "a_position");
    gl.enableVertexAttribArray(pos);
    gl.vertexAttribPointer(pos, 2, gl.FLOAT, false, 0, 0);

    function render() {
        gl.viewport(0, 0, canvas.width, canvas.height);
        gl.useProgram(program);
        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
        // requestAnimationFrame(render);
    }
    render();
</script>
